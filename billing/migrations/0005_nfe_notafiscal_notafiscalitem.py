# Generated by Django 4.2.7 on 2026-02-09 23:53

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('multitenancy', '0028_company_notes_entity_notes_etlpipelinelog_notes_and_more'),
        ('billing', '0004_businesspartner_notes_businesspartnercategory_notes_and_more'),
    ]

    operations = [
        migrations.CreateModel(
            name='NotaFiscal',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now_add=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('notes', models.TextField(blank=True, help_text='Metadata and notes about how this record was created (source, filename, function, etc.)', null=True)),
                ('chave', models.CharField(db_index=True, max_length=44, unique=True, verbose_name='Chave de acesso')),
                ('numero', models.IntegerField(verbose_name='Número NF')),
                ('serie', models.SmallIntegerField(default=1, verbose_name='Série')),
                ('modelo', models.SmallIntegerField(choices=[(55, 'NF-e'), (65, 'NFC-e')], default=55, verbose_name='Modelo')),
                ('tipo_operacao', models.SmallIntegerField(choices=[(0, 'Entrada'), (1, 'Saída')], verbose_name='Tipo operação')),
                ('finalidade', models.SmallIntegerField(choices=[(1, 'Normal'), (2, 'Complementar'), (3, 'Ajuste'), (4, 'Devolução')], default=1, verbose_name='Finalidade')),
                ('natureza_operacao', models.CharField(max_length=200, verbose_name='Natureza da operação')),
                ('ambiente', models.SmallIntegerField(choices=[(1, 'Produção'), (2, 'Homologação')], default=1, verbose_name='Ambiente')),
                ('id_destino', models.SmallIntegerField(choices=[(1, 'Interna'), (2, 'Interestadual'), (3, 'Exterior')], default=1, verbose_name='Destino da operação')),
                ('ind_final', models.SmallIntegerField(choices=[(0, 'Não'), (1, 'Consumidor Final')], default=0, verbose_name='Consumidor final')),
                ('ind_presenca', models.SmallIntegerField(choices=[(0, 'Não se aplica'), (1, 'Presencial'), (2, 'Internet'), (3, 'Teleatendimento'), (4, 'Entrega domicílio'), (9, 'Outros')], default=9, verbose_name='Presença do comprador')),
                ('data_emissao', models.DateTimeField(db_index=True, verbose_name='Data emissão')),
                ('data_saida_entrada', models.DateTimeField(blank=True, null=True, verbose_name='Data saída/entrada')),
                ('emit_cnpj', models.CharField(db_index=True, max_length=14, verbose_name='CNPJ emitente')),
                ('emit_nome', models.CharField(max_length=300, verbose_name='Razão social emitente')),
                ('emit_fantasia', models.CharField(blank=True, max_length=300, verbose_name='Nome fantasia emitente')),
                ('emit_ie', models.CharField(blank=True, max_length=20, verbose_name='IE emitente')),
                ('emit_crt', models.CharField(blank=True, help_text='1=Simples Nacional, 2=SN excesso, 3=Regime Normal', max_length=1, verbose_name='CRT emitente')),
                ('emit_uf', models.CharField(max_length=2, verbose_name='UF emitente')),
                ('emit_municipio', models.CharField(blank=True, max_length=100, verbose_name='Município emitente')),
                ('dest_cnpj', models.CharField(db_index=True, max_length=14, verbose_name='CNPJ/CPF destinatário')),
                ('dest_nome', models.CharField(max_length=300, verbose_name='Razão social destinatário')),
                ('dest_ie', models.CharField(blank=True, max_length=20, verbose_name='IE destinatário')),
                ('dest_uf', models.CharField(blank=True, max_length=2, verbose_name='UF destinatário')),
                ('dest_ind_ie', models.CharField(blank=True, help_text='1=Contribuinte, 2=Isento, 9=Não contribuinte', max_length=1, verbose_name='Indicador IE dest')),
                ('valor_nota', models.DecimalField(decimal_places=2, max_digits=15, verbose_name='Valor total NF')),
                ('valor_produtos', models.DecimalField(decimal_places=2, max_digits=15, verbose_name='Valor produtos')),
                ('valor_icms', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='ICMS')),
                ('valor_icms_st', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='ICMS ST')),
                ('valor_ipi', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='IPI')),
                ('valor_pis', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='PIS')),
                ('valor_cofins', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='COFINS')),
                ('valor_frete', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Frete')),
                ('valor_seguro', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Seguro')),
                ('valor_desconto', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Desconto')),
                ('valor_outras', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Outras despesas')),
                ('valor_icms_uf_dest', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='ICMS UF destino')),
                ('valor_trib_aprox', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Tributos aprox')),
                ('protocolo', models.CharField(blank=True, max_length=20, verbose_name='Protocolo')),
                ('status_sefaz', models.CharField(blank=True, max_length=5, verbose_name='Status SEFAZ')),
                ('motivo_sefaz', models.CharField(blank=True, max_length=300, verbose_name='Motivo SEFAZ')),
                ('data_autorizacao', models.DateTimeField(blank=True, null=True, verbose_name='Data autorização')),
                ('mod_frete', models.SmallIntegerField(choices=[(0, 'Emitente/Remetente'), (1, 'Destinatário'), (2, 'Terceiros'), (3, 'Próprio emitente'), (4, 'Próprio destinatário'), (9, 'Sem frete')], default=9, verbose_name='Modalidade frete')),
                ('transporte_json', models.JSONField(blank=True, default=dict, help_text='{"transportadora": {...}, "volumes": [...]}', verbose_name='Transporte (detalhes)')),
                ('financeiro_json', models.JSONField(blank=True, default=list, help_text='[{"tipo": "duplicata", "nDup": "001", "dVenc": "...", "vDup": "..."}, ...]', verbose_name='Financeiro')),
                ('referencias_json', models.JSONField(blank=True, default=list, help_text='["chave_44_digitos", ...]', verbose_name='Referências')),
                ('totais_json', models.JSONField(blank=True, default=dict, verbose_name='Totais completos ICMSTot')),
                ('info_complementar', models.TextField(blank=True, verbose_name='Info complementar')),
                ('info_fisco', models.TextField(blank=True, verbose_name='Info ao fisco')),
                ('xml_original', models.TextField(blank=True, help_text='Conteúdo bruto do XML para auditoria e reprocessamento', verbose_name='XML original')),
                ('arquivo_origem', models.CharField(blank=True, max_length=500, verbose_name='Arquivo de origem')),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_company', to='multitenancy.company')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created_by', to=settings.AUTH_USER_MODEL)),
                ('destinatario', models.ForeignKey(blank=True, help_text='Vínculo automático por CNPJ com BusinessPartner.identifier', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='nfe_recebidas', to='billing.businesspartner', verbose_name='Parceiro destinatário')),
                ('emitente', models.ForeignKey(blank=True, help_text='Vínculo automático por CNPJ com BusinessPartner.identifier', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='nfe_emitidas', to='billing.businesspartner', verbose_name='Parceiro emitente')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated_by', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Nota Fiscal Eletrônica',
                'verbose_name_plural': 'Notas Fiscais Eletrônicas',
                'ordering': ['-data_emissao'],
            },
        ),
        migrations.CreateModel(
            name='NotaFiscalItem',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now_add=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('notes', models.TextField(blank=True, help_text='Metadata and notes about how this record was created (source, filename, function, etc.)', null=True)),
                ('numero_item', models.SmallIntegerField(verbose_name='N. item')),
                ('codigo_produto', models.CharField(max_length=60, verbose_name='Código produto (cProd)')),
                ('ean', models.CharField(blank=True, max_length=14, verbose_name='EAN/GTIN')),
                ('descricao', models.CharField(max_length=500, verbose_name='Descrição (xProd)')),
                ('ncm', models.CharField(db_index=True, max_length=8, verbose_name='NCM')),
                ('cest', models.CharField(blank=True, max_length=7, verbose_name='CEST')),
                ('cfop', models.CharField(db_index=True, max_length=4, verbose_name='CFOP')),
                ('unidade', models.CharField(max_length=6, verbose_name='Unidade (uCom)')),
                ('quantidade', models.DecimalField(decimal_places=4, max_digits=15, verbose_name='Quantidade')),
                ('valor_unitario', models.DecimalField(decimal_places=10, max_digits=15, verbose_name='Valor unitário')),
                ('valor_total', models.DecimalField(decimal_places=2, max_digits=15, verbose_name='Valor total item')),
                ('icms_origem', models.SmallIntegerField(choices=[(0, 'Nacional'), (1, 'Estrangeira importação direta'), (2, 'Estrangeira mercado interno'), (3, 'Nacional 40-70% conteúdo importado'), (4, 'Nacional produção conforme'), (5, 'Nacional conteúdo importado < 40%'), (6, 'Estrangeira importação direta sem similar'), (7, 'Estrangeira mercado interno sem similar'), (8, 'Nacional conteúdo importado > 70%')], default=0, verbose_name='Origem mercadoria')),
                ('icms_cst', models.CharField(blank=True, help_text='CST (regime normal) ou CSOSN (Simples Nacional)', max_length=4, verbose_name='CST/CSOSN ICMS')),
                ('icms_base', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='BC ICMS')),
                ('icms_aliquota', models.DecimalField(decimal_places=4, default=0, max_digits=7, verbose_name='Alíquota ICMS %')),
                ('icms_valor', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Valor ICMS')),
                ('icms_st_base', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='BC ICMS ST')),
                ('icms_st_valor', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Valor ICMS ST')),
                ('pis_cst', models.CharField(blank=True, max_length=2, verbose_name='CST PIS')),
                ('pis_base', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='BC PIS')),
                ('pis_aliquota', models.DecimalField(decimal_places=4, default=0, max_digits=7, verbose_name='Alíquota PIS %')),
                ('pis_valor', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Valor PIS')),
                ('cofins_cst', models.CharField(blank=True, max_length=2, verbose_name='CST COFINS')),
                ('cofins_base', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='BC COFINS')),
                ('cofins_aliquota', models.DecimalField(decimal_places=4, default=0, max_digits=7, verbose_name='Alíquota COFINS %')),
                ('cofins_valor', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Valor COFINS')),
                ('ipi_cst', models.CharField(blank=True, max_length=2, verbose_name='CST IPI')),
                ('ipi_valor', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Valor IPI')),
                ('icms_uf_dest_base', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='BC ICMS UF Dest')),
                ('icms_uf_dest_valor', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Valor ICMS UF Dest')),
                ('icms_uf_remet_valor', models.DecimalField(decimal_places=2, default=0, max_digits=15, verbose_name='Valor ICMS UF Remet')),
                ('impostos_json', models.JSONField(blank=True, default=dict, help_text='Árvore XML completa de impostos para variantes não cobertas pelos campos flat', verbose_name='Impostos (árvore completa)')),
                ('info_adicional', models.TextField(blank=True, verbose_name='Info adicional do item')),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_company', to='multitenancy.company')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created_by', to=settings.AUTH_USER_MODEL)),
                ('nota_fiscal', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='itens', to='billing.notafiscal', verbose_name='Nota Fiscal')),
                ('produto', models.ForeignKey(blank=True, help_text='Vínculo automático por codigo_produto vs ProductService.code ou EAN', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='nfe_itens', to='billing.productservice', verbose_name='Produto/Serviço cadastrado')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated_by', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Item de Nota Fiscal',
                'verbose_name_plural': 'Itens de Notas Fiscais',
                'ordering': ['nota_fiscal', 'numero_item'],
                'indexes': [models.Index(fields=['ncm'], name='billing_not_ncm_599604_idx'), models.Index(fields=['cfop'], name='billing_not_cfop_d8f442_idx')],
                'unique_together': {('nota_fiscal', 'numero_item')},
            },
        ),
        migrations.AddIndex(
            model_name='notafiscal',
            index=models.Index(fields=['emit_cnpj', 'data_emissao'], name='billing_not_emit_cn_ed43cc_idx'),
        ),
        migrations.AddIndex(
            model_name='notafiscal',
            index=models.Index(fields=['dest_cnpj', 'data_emissao'], name='billing_not_dest_cn_772337_idx'),
        ),
        migrations.AddIndex(
            model_name='notafiscal',
            index=models.Index(fields=['finalidade'], name='billing_not_finalid_8041e4_idx'),
        ),
    ]
