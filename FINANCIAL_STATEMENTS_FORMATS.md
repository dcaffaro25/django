# Financial Statements - Formatos de Saída

## Formatos Disponíveis

O sistema de financial statements suporta múltiplos formatos de saída:

### 1. JSON (Padrão)
Formato padrão retornado pela API. Inclui todas as informações estruturadas.

**Endpoint:**
```
POST /api/financial-statements/generate/
```

**Resposta:**
```json
{
  "id": 1,
  "name": "Balance Sheet 2025",
  "report_type": "balance_sheet",
  "start_date": "2025-01-01",
  "end_date": "2025-12-31",
  "lines": [
    {
      "id": 1,
      "line_number": 1,
      "label": "ASSETS",
      "line_type": "header",
      "balance": "0.00",
      ...
    }
  ],
  "total_assets": "1000000.00",
  "formatted": {
    "markdown": "# Balance Sheet 2025\n\n...",
    "html": "<!DOCTYPE html>..."
  }
}
```

**Com query parameter:**
```
POST /api/financial-statements/generate/?format=json
```

### 2. Markdown
Formato Markdown para documentação e versionamento.

**Endpoint:**
```
POST /api/financial-statements/generate/?format=markdown
```

**Ou exportar statement existente:**
```
GET /api/financial-statements/{id}/export_markdown/
```

**Exemplo de saída:**
```markdown
# Balance Sheet 2025

**Report Type:** Balance Sheet
**Period:** 2025-01-01 to 2025-12-31
**Currency:** USD
**Status:** draft

---

| Line | Label | Debit | Credit | Balance |
|------|-------|-------|--------|---------|
| 1 | ASSETS | - | - | - |
| 2 |   Current Assets | - | - | - |
| 3 |     Cash and Cash Equivalents | - | - | $50,000.00 |

## Totals

**Total Assets:** $1,000,000.00
**Total Liabilities:** $500,000.00
**Total Equity:** $500,000.00

---

*Generated on 2025-11-29 22:53:05*
*Generated by: John Doe*
```

### 3. HTML
Formato HTML formatado com CSS para visualização em navegador.

**Endpoint:**
```
POST /api/financial-statements/generate/?format=html
```

**Ou exportar statement existente:**
```
GET /api/financial-statements/{id}/export_html/
```

**Características:**
- CSS embutido para formatação
- Tabelas responsivas
- Cores para totais e headers
- Formatação de valores negativos
- Indentação visual para hierarquia

### 4. Excel
Formato Excel (.xlsx) para análise em planilhas.

**Endpoint:**
```
GET /api/financial-statements/{id}/export_excel/
```

**Características:**
- Arquivo .xlsx
- Headers formatados
- Totais calculados
- Download direto

## Uso dos Formatos

### Gerar e Receber em Formato Específico

```bash
# JSON (padrão, inclui formatted.markdown e formatted.html)
POST /api/financial-statements/generate/
{
  "template_id": 1,
  "start_date": "2025-01-01",
  "end_date": "2025-12-31"
}

# Apenas Markdown
POST /api/financial-statements/generate/?format=markdown
{
  "template_id": 1,
  "start_date": "2025-01-01",
  "end_date": "2025-12-31"
}

# Apenas HTML
POST /api/financial-statements/generate/?format=html
{
  "template_id": 1,
  "start_date": "2025-01-01",
  "end_date": "2025-12-31"
}
```

### Exportar Statement Existente

```bash
# Exportar como Markdown
GET /api/financial-statements/1/export_markdown/

# Exportar como HTML
GET /api/financial-statements/1/export_html/

# Exportar como Excel
GET /api/financial-statements/1/export_excel/
```

## Estrutura dos Formatos

### JSON
- Estrutura completa do objeto
- Todas as linhas com detalhes
- Metadados completos
- Inclui versões formatadas em `formatted.markdown` e `formatted.html`

### Markdown
- Tabelas formatadas
- Headers hierárquicos
- Formatação de valores monetários
- Metadados no footer

### HTML
- CSS embutido
- Tabelas estilizadas
- Cores e formatação visual
- Responsivo
- Valores negativos destacados

### Excel
- Planilha estruturada
- Headers e totais
- Pronto para análise

## Exemplos de Uso

### Python/Requests

```python
import requests

# Gerar e receber JSON com versões formatadas
response = requests.post(
    'https://api.example.com/api/financial-statements/generate/',
    json={
        'template_id': 1,
        'start_date': '2025-01-01',
        'end_date': '2025-12-31'
    },
    headers={'Authorization': 'Token YOUR_TOKEN'}
)
data = response.json()
print(data['formatted']['markdown'])  # Versão Markdown
print(data['formatted']['html'])      # Versão HTML

# Gerar e receber apenas Markdown
response = requests.post(
    'https://api.example.com/api/financial-statements/generate/?format=markdown',
    json={...}
)
markdown_content = response.text

# Exportar statement existente como HTML
response = requests.get(
    'https://api.example.com/api/financial-statements/1/export_html/',
    headers={'Authorization': 'Token YOUR_TOKEN'}
)
html_content = response.text
```

### JavaScript/Fetch

```javascript
// Gerar statement e receber JSON
const response = await fetch('/api/financial-statements/generate/', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Token YOUR_TOKEN'
  },
  body: JSON.stringify({
    template_id: 1,
    start_date: '2025-01-01',
    end_date: '2025-12-31'
  })
});

const data = await response.json();
console.log(data.formatted.markdown); // Markdown
console.log(data.formatted.html);     // HTML

// Gerar e receber apenas HTML
const htmlResponse = await fetch(
  '/api/financial-statements/generate/?format=html',
  {
    method: 'POST',
    headers: {...},
    body: JSON.stringify({...})
  }
);
const htmlContent = await htmlResponse.text();
document.body.innerHTML = htmlContent; // Renderizar HTML
```

## Content Types

- **JSON:** `application/json`
- **Markdown:** `text/markdown; charset=utf-8`
- **HTML:** `text/html; charset=utf-8`
- **Excel:** `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`

## Notas

- O formato JSON padrão sempre inclui `formatted.markdown` e `formatted.html` na resposta
- Use `?format=markdown` ou `?format=html` para receber apenas aquele formato
- Os endpoints de export (`export_markdown`, `export_html`, `export_excel`) retornam arquivos para download
- Valores negativos são formatados com parênteses: `($1,000.00)`
- HTML inclui CSS embutido, não requer arquivos externos
- Markdown é compatível com GitHub, GitLab, e outros renderizadores

